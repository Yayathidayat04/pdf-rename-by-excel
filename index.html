<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Rename PDF Berdasarkan Excel</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; padding: 40px; }
    input { margin: 10px; }
    button { padding: 10px 20px; }
  </style>
</head>
<body>
  <h2>Ubah Nama File PDF Berdasarkan Excel</h2>

  <p>1. Unggah file Excel (dengan kolom: Nama Lama, Nama Baru)</p>
  <input type="file" id="excelFile" accept=".xlsx, .xls">
  
  <p>2. Unggah file PDF yang ingin diubah namanya</p>
  <input type="file" id="pdfFiles" accept=".pdf" multiple>

  <br><br>
  <button onclick="processFiles()">Proses & Unduh</button>
  <p id="status"></p>

  <script>
    let renameMap = {};

    function readExcel(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = (e) => {
          const data = new Uint8Array(e.target.result);
          const workbook = XLSX.read(data, { type: "array" });
          const sheet = workbook.Sheets[workbook.SheetNames[0]];
          const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });
          const map = {};

          for (let i = 1; i < rows.length; i++) {
            const [oldName, newName] = rows[i];
            if (oldName && newName) {
              map[oldName.trim()] = newName.trim();
            }
          }
          resolve(map);
        };
        reader.onerror = reject;
        reader.readAsArrayBuffer(file);
      });
    }

    async function processFiles() {
      const excelInput = document.getElementById("excelFile");
      const pdfInput = document.getElementById("pdfFiles");
      const status = document.getElementById("status");

      if (!excelInput.files[0] || pdfInput.files.length === 0) {
        alert("Mohon unggah file Excel dan file PDF.");
        return;
      }

      status.textContent = "Memproses...";

      try {
        const map = await readExcel(excelInput.files[0]);
        const zip = new JSZip();
        let renamedCount = 0;

        for (const file of pdfInput.files) {
          const newName = map[file.name];
          if (newName) {
            zip.file(newName, file);
            renamedCount++;
          }
        }

        if (renamedCount === 0) {
          status.textContent = "Tidak ada file PDF yang cocok dengan Excel.";
          return;
        }

        const blob = await zip.generateAsync({ type: "blob" });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "pdf_renamed.zip";
        link.click();
        status.textContent = `Selesai! ${renamedCount} file berhasil diganti namanya.`;
      } catch (err) {
        status.textContent = "Terjadi kesalahan: " + err;
      }
    }
  </script>
</body>
</html>
